---
# install Kolibri install support python libraries -> moved to ospackages.yml
#apt install libffi-dev python3-pip python3-pkg-resources dirmngr -y

- name: Set kolibri.local
  ansible.builtin.copy:
    src: "nginx/kolibri.local"
    dest: /etc/nginx/sites-available/kolibri.local
  notify:
    - Restart Nginx
 
- name: Enable kolibri nginx configuration
  ansible.builtin.file:
    src: /etc/nginx/sites-available/kolibri.local
    dest: /etc/nginx/sites-enabled/kolibri.local
    owner: root
    group: root
    state: link
  notify:
    - Restart Nginx

# install pip3 packages
- name: Install multi python packages with version specifiers
  pip:
    name:
      - pip
      - setuptools
      - cffi
    executable: pip3
    
#Install Kolibri components
- name: Install applications
  apt:
    name:
    - kolibri
    - kolibri-server

# Configure kolibri to use content disk
- name: Copy kolibri 099-user.conf  
  ansible.builtin.copy:
    src: kolibri/099-user.conf
    dest: /etc/kolibri/nginx.d/099-user.conf 
    owner: root 
    group: root 
    mode: '0755'

- name: Copy kolibri daemon.conf
  ansible.builtin.copy:
    src: kolibri/daemon.conf
    dest: /etc/kolibri/daemon.conf
    owner: root
    group: root
    mode: '0755'
